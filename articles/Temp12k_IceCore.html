<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Temp12k_IceCore • compositeR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Temp12k_IceCore">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">compositeR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Temp12k_IceCore.html">Temp12k_IceCore</a>
    </li>
    <li>
      <a href="../articles/Temp12k-DCC.html">Temp12k-DCC</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Temp12k_IceCore</h1>
            
      

      <div class="hidden name"><code>Temp12k_IceCore.Rmd</code></div>

    </div>

    
    
<p>Paleoclimate proxy records are used to evaluate long term changes in
Earth’s climate at a single location. To calculate regional or global
trends, composite records are often developed by averaging the values
from different proxy timeseries to find the common climate signal among
the various proxy records. However, records differ in the timespan they
cover and the resolution at which a variable was measured. The variance
of a record may also be impacted by these differences or by factors
related to the deposition and archival of the proxy material.</p>
<p><strong>The compositeR package is meant to provide one stop shop for
prepossessing and stacking multiple records into a single
timeseries</strong></p>
<p>Standard Calibrated Composite (SCC) is one method which uses a single
time window to align multiple records. SCC was one of five methods used
by <a href="https://doi.org/10.1038/s41597-020-0530-7" class="external-link">Kaufman et
al. (2020)</a> who describes the method as assuming “that the
temperature variance is accurate for all proxy time series. Calculations
rely on values in °C rather than standardized SD units. The
non-calibrated records in the Temperature 12k database were not used”.
In other words, SCC simply adjusts the mean within a given time interval
to equal 0 for each record, and these anomalies are averaged
together.</p>
<p><strong>For this demonstration, we’ll apply the SCC method to a small
subset of the <a href="https://lipdverse.org/project/temp12k/" class="external-link">Temp12k</a>
dataset</strong></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#LiPD packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">lipdR</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">compositeR</span><span class="op">)</span> <span class="co">#devtools::load_all() #</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nickmckay/GeoChronR" class="external-link">geoChronR</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="font-weight: bold;">Welcome to geoChronR version 1.1.14!</span></span></span>
<span><span class="co">#General Packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span></code></pre></div>
<p><strong>We’ve already loaded the Temp12k LiPD files into the project
data folder as “Temp12k”</strong></p>
<ul>
<li>Refer to the “/data-raw/Temp12k.R” script for more information about
how to load the data.</li>
<li>First we’ll filter the Temp12k to only consider calibrated ice core
records from the arctic for our demonstation.</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Load Temp12k files (already extracted) from package/data folder</span></span>
<span><span class="va">Temp12k</span> <span class="op">&lt;-</span> <span class="va">Temp12k</span></span>
<span><span class="co">#Filter for demonstration</span></span>
<span><span class="va">idx</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/lipdR/man/pullTsVariable.html" class="external-link">pullTsVariable</a></span><span class="op">(</span><span class="va">Temp12k</span>,<span class="st">'geo_latitude'</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">50</span><span class="op">)</span> <span class="op">&amp;</span> <span class="co">#arctic</span></span>
<span>       <span class="co">#ice core</span></span>
<span>       <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/lipdR/man/pullTsVariable.html" class="external-link">pullTsVariable</a></span><span class="op">(</span><span class="va">Temp12k</span>,<span class="st">'archiveType'</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="st">'glacierice'</span><span class="op">)</span> <span class="op">&amp;</span>  </span>
<span>       <span class="co">#Calibrated units</span></span>
<span>       <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/lipdR/man/pullTsVariable.html" class="external-link">pullTsVariable</a></span><span class="op">(</span><span class="va">Temp12k</span>,<span class="st">'paleoData_units'</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="st">'degc'</span><span class="op">)</span> <span class="op">&amp;</span> </span>
<span>       <span class="co">#if there is a summer and annual record, only choose the annual (the summer will be labeled as summer+)</span></span>
<span>       <span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/lipdR/man/pullTsVariable.html" class="external-link">pullTsVariable</a></span><span class="op">(</span><span class="va">Temp12k</span>,<span class="st">'climateInterpretation1_seasonalityGeneral'</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'annual'</span>,<span class="st">'summeronly'</span>,<span class="st">'winteronly'</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">fTS</span> <span class="op">&lt;-</span> <span class="va">Temp12k</span><span class="op">[</span><span class="va">idx</span><span class="op">]</span></span>
<span><span class="co">#Map data to get a quick sense of what records we're using</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">geoChronR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/geoChronR/man/mapTs.html" class="external-link">mapTs</a></span><span class="op">(</span><span class="va">fTS</span>,color<span class="op">=</span><span class="st">'dataSetName'</span>,size<span class="op">=</span><span class="fl">5</span>,lat.range<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">55</span>,<span class="fl">85</span><span class="op">)</span>,lon.range<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">90</span>,<span class="op">-</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Temp12k_IceCore_files/figure-html/unnamed-chunk-3-1.png" width="624"></p>
<p><strong>Now let’s look at the timeseries data (this code chunk does
not use any compositeR function)</strong></p>
<ul>
<li>You’ll notice that the data have different temporal
resolutions.</li>
<li>Additionally, some data are provided as absolute temperature values,
but some are anomalies.</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Rearrange the data for plotting</span></span>
<span><span class="va">fTS_df_raw</span> <span class="op">&lt;-</span> <span class="fu">lipdR</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lipdR/man/ts2tibble.html" class="external-link">ts2tibble</a></span><span class="op">(</span><span class="va">fTS</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>row <span class="op">=</span> <span class="va">dataSetName</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">paleoData_values</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>record <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">row</span>, <span class="fu"><a href="https://rdrr.io/r/base/lengths.html" class="external-link">lengths</a></span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#Plot the raw data</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">fTS_df_raw</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">paleoData_values</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">record</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Raw data"</span>, x <span class="op">=</span> <span class="st">"age (yr BP)"</span>, y <span class="op">=</span> <span class="st">"temperature (degC)"</span>, color <span class="op">=</span> <span class="st">"record"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_reverse</a></span><span class="op">(</span>limits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12000</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Temp12k_IceCore_files/figure-html/unnamed-chunk-4-1.png" width="624"></p>
<p><strong>Now let’s start looking at the composite process. First we
need to define a common time axis to convert all of the data
to</strong></p>
<ul>
<li>The 100 year bin step was chosen for Temp12k. You’ll want to choose
a binvec that is most appropriate for your research question and data
resolution</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Age vectors to composite with</span></span>
<span><span class="va">binvec</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">50</span>, to <span class="op">=</span> <span class="fl">12050</span>, by <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">binAges</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">binvec</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>,<span class="va">binvec</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">binvec</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><strong>The simpleBinTs() function applies a uniform temporal
resolution using a nearest neighbor interpolation</strong></p>
<ul>
<li>Data within the same bin (binvec) are averaged.</li>
<li>You can “fill” empty bins with nearby values if spread==TRUE
(default).
<ul>
<li>Turn this off by setting spread=FALSE.<br>
</li>
<li>Use spreadMax or spreadMaxPct to limit how far data can be spread
(the default is stats::quantile(diff(ages),0.75).</li>
</ul>
</li>
<li>Alternatively, You can use sampleEnsembleThenBinTs().
<ul>
<li>This function will sample from an ageEnsemble matrix or generate an
ensemble using BAM.</li>
<li>It will also add value uncertainty (default=1.5).</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Bin the values to a common timestep using simpleBinTs()</span></span>
<span><span class="va">binMat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_dfc</a></span><span class="op">(</span><span class="va">fTS</span>,<span class="va">simpleBinTs</span>,<span class="va">binvec</span>,spread<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#Rearrange the data for plotting</span></span>
<span><span class="va">fTS_df_binned</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">binAges</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">binMat</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  paleoData_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">binMat</span><span class="op">)</span>,</span>
<span>  record <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">binMat</span><span class="op">)</span>, each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">binAges</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#Plot the binned data</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">fTS_df_binned</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">paleoData_values</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">record</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Binned data using simpleBinTs() at 100 year resolution"</span>, x <span class="op">=</span> <span class="st">"age (yr BP)"</span>, y <span class="op">=</span> <span class="st">"temperature (degC)"</span>, color <span class="op">=</span> <span class="st">"record"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_reverse</a></span><span class="op">(</span>limits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12000</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Temp12k_IceCore_files/figure-html/unnamed-chunk-6-1.png" width="624"></p>
<p><strong>The standardizeOverInterval() function scales the data as an
anomaly relative to a defined interval</strong></p>
<ul>
<li>If normalizeVariance==False, only the mean value during this
interval will be subtracted.</li>
<li>If normalizeVariance==True, the variance of each record will be
scaled to a constant variance within the interval.
<ul>
<li>If you are working with data different units, this should be
TRUE.</li>
</ul>
</li>
<li>standardizeOverRandomInterval() can be used to apply a random
interval within a defined searchRange.
<ul>
<li>For this, you will also need to define a duration to find within the
searchRange</li>
</ul>
</li>
<li>Because we’re only removing the mean and this is a demo, we’ll
reduce minN (the minimum number of data points within the interval for a
record to be included; default=8) so that all records are used.</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interval</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3000</span>,<span class="fl">5000</span><span class="op">)</span></span>
<span><span class="co">#Standardize anomalies to reference window</span></span>
<span><span class="va">stanMat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/standardizeOverInterval.html">standardizeOverInterval</a></span><span class="op">(</span><span class="va">binAges</span>,<span class="va">binMat</span>,<span class="va">interval</span>,normalizeVariance<span class="op">=</span><span class="cn">FALSE</span>,minN<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#Rearrange the data for plotting</span></span>
<span><span class="va">fTS_df_standardized</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">binAges</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">stanMat</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  paleoData_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">stanMat</span><span class="op">)</span>,</span>
<span>  record <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">stanMat</span><span class="op">)</span>, each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">binAges</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#Plot the binned data</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">fTS_df_standardized</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">paleoData_values</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">record</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">interval</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, xmax <span class="op">=</span> <span class="va">interval</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, ymin <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, ymax <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.01</span>, fill<span class="op">=</span><span class="st">"lightgrey"</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Binned &amp; standardized data"</span>, x <span class="op">=</span> <span class="st">"age (yr BP)"</span>, y <span class="op">=</span> <span class="st">"temperature (degC)"</span>, color <span class="op">=</span> <span class="st">"record"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_reverse</a></span><span class="op">(</span>limits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12000</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Temp12k_IceCore_files/figure-html/unnamed-chunk-7-1.png" width="624"></p>
<p><strong>Once the data are binned and standardized, use can calculate
the composite mean</strong></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Calculate weighted mean of standardized records</span></span>
<span><span class="va">compMean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">stanMat</span>,<span class="fl">1</span>,<span class="va">mean</span>,na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span><span class="co">#Plot the binned data with composite mean</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">fTS_df_standardized</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">paleoData_values</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">record</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">interval</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, xmax <span class="op">=</span> <span class="va">interval</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, ymin <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, ymax <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.01</span>, fill<span class="op">=</span><span class="st">"lightgrey"</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">binAges</span>,y<span class="op">=</span><span class="va">compMean</span><span class="op">)</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">binAges</span>,y<span class="op">=</span><span class="va">y</span><span class="op">)</span>,color<span class="op">=</span><span class="st">'black'</span>,size<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Binned &amp; standardized data (black = composite mean)"</span>, x <span class="op">=</span> <span class="st">"age (yr BP)"</span>, y <span class="op">=</span> <span class="st">"temperature (degC)"</span>, color <span class="op">=</span> <span class="st">"record"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_reverse</a></span><span class="op">(</span>limits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12000</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Temp12k_IceCore_files/figure-html/unnamed-chunk-8-1.png" width="624"></p>
<p><strong>All of the necessary parameters can be applied in one
function using the compositeEnsembles() function which will produce the
same results with less code</strong></p>
<p>Several additional defaults for the temp12k analysis (such as
compositeSCC()) apply specific preset parameters to the
compositeEnsembles() function.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#All of these steps can be applies useing wrapper function</span></span>
<span><span class="va">composite</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compositeEnsembles.html">compositeEnsembles</a></span><span class="op">(</span><span class="va">fTS</span>,</span>
<span>                                binvec<span class="op">=</span><span class="va">binvec</span>,</span>
<span>                                binFun<span class="op">=</span><span class="va">simpleBinTs</span>,</span>
<span>                                stanFun<span class="op">=</span><span class="va">standardizeOverInterval</span>,</span>
<span>                                normalizeVariance<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>                                interval<span class="op">=</span><span class="va">interval</span>,</span>
<span>                                minN<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#This method can also be written as: composite &lt;- compositeSCC(fTS,binvec,binFun=simpleBinTs,minN=5)</span></span>
<span><span class="co">#Plot the comparison between this wrapper function with composite mean</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">fTS_df_standardized</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">age</span>, y <span class="op">=</span> <span class="va">paleoData_values</span>, color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">record</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">binAges</span>,y<span class="op">=</span><span class="va">compMean</span><span class="op">)</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">binAges</span>,y<span class="op">=</span><span class="va">y</span><span class="op">)</span>,color<span class="op">=</span><span class="st">'black'</span>,size<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">binAges</span>,y<span class="op">=</span><span class="va">composite</span><span class="op">$</span><span class="va">composite</span><span class="op">)</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">binAges</span>,y<span class="op">=</span><span class="va">y</span><span class="op">)</span>,color<span class="op">=</span><span class="st">'red'</span>,size<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Comparison between compositeEnsembles() with step by step analysis"</span>, x <span class="op">=</span> <span class="st">"age (yr BP)"</span>, y <span class="op">=</span> <span class="st">"temperature (degC)"</span>, color <span class="op">=</span> <span class="st">"record"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_reverse</a></span><span class="op">(</span>limits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">12000</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Temp12k_IceCore_files/figure-html/unnamed-chunk-9-1.png" width="624"></p>
<p><strong>Now let’s create an ensemble using
sampleEnsembleThenBinTs</strong></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Number of iterations to perform</span></span>
<span><span class="va">nens</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span></span>
<span><span class="co">#Ensemble composite using "all-in-one" wrapper function</span></span>
<span><span class="va">ensOut</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compositeEnsembles2.html">compositeEnsembles2</a></span><span class="op">(</span><span class="va">fTS</span>,</span>
<span>                                binvec<span class="op">=</span><span class="va">binvec</span>,</span>
<span>                                binFun<span class="op">=</span><span class="va">sampleEnsembleThenBinTs</span>,</span>
<span>                                stanFun<span class="op">=</span><span class="va">standardizeOverInterval</span>,</span>
<span>                                normalizeVariance<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>                                nens<span class="op">=</span><span class="va">nens</span>,</span>
<span>                                interval<span class="op">=</span><span class="va">interval</span>,</span>
<span>                                minN<span class="op">=</span><span class="fl">5</span></span>
<span>                              <span class="op">)</span></span>
<span><span class="co">#&gt; [1] "binning and aligning the data. This may take some time depending on the number of records (length(fTS)) and number of ensembles (nens)"</span></span>
<span></span>
<span><span class="fu"><a href="../reference/printComposite.html">printComposite</a></span><span class="op">(</span><span class="va">ensOut</span><span class="op">)</span></span>
<span><span class="co">#&gt; Composite created for ages: <span style="color: #00BB00;">0-12000</span> yr BP at <span style="color: #00BB00;">100</span> year resolution</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">5</span> proxy records used. The maximum data density occurs between <span style="color: #00BB00;">100-11500</span> yr BP</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">50</span> ensembles generated</span></span>
<span><span class="co">#&gt; The maximum median value occurs at <span style="color: #BB0000;">7900</span> yr BP.</span></span>
<span><span class="co">#&gt; The minimum median value occurs at <span style="color: #0000BB;">12000</span> yr BP.</span></span>
<span><span class="co">#&gt;   age  median count</span></span>
<span><span class="co">#&gt; 1   0 -0.5655     3</span></span>
<span><span class="co">#&gt; 2 100 -0.9123     5</span></span>
<span><span class="co">#&gt; 3 200 -0.8620     5</span></span>
<span><span class="co">#&gt; 4 300 -1.6259     5</span></span>
<span><span class="co">#&gt; 5 400 -1.6458     5</span></span>
<span><span class="co">#&gt; 6 500 -1.7339     5</span></span>
<span><span class="co">#TODO why is this plotting twice?</span></span>
<span><span class="fu"><a href="../reference/plotComposite.html">plotComposite</a></span><span class="op">(</span><span class="va">ensOut</span><span class="op">)</span></span></code></pre></div>
<p><img src="Temp12k_IceCore_files/figure-html/unnamed-chunk-10-1.png" width="624"><img src="Temp12k_IceCore_files/figure-html/unnamed-chunk-10-2.png" width="624"></p>
<p>devtools::build_rmd(“vignettes/Temp12k_IceCore.Rmd”)</p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by McKay Nick, Hancock Christopher.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

      </footer>
</div>






  </body>
</html>
